<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å¯“ç‰©ä¸šæ”¶è´¹ç³»ç»Ÿ - ç™»å½•</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¢</text></svg>?v=2">
    
    <!-- å†…è”å…³é”®CSSï¼Œå‡å°‘LCPæ—¶é—´ -->
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        .login-container {
            width: 380px;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #303133;
            font-size: 24px;
            font-weight: 600;
        }
        .login-footer {
            margin-top: 20px;
            text-align: center;
            color: #909399;
            font-size: 12px;
        }
        /* é˜²æ­¢Vueæœªç¼–è¯‘é—ªçƒ */
        [v-cloak] {
            display: none;
        }
    </style>
    
    <!-- å¼•å…¥ Element Plus æ ·å¼ -->
    <link rel="stylesheet" href="/static/lib/element-plus.css">
    
    <!-- ä½¿ç”¨deferå¼‚æ­¥åŠ è½½è„šæœ¬ï¼Œä¸é˜»å¡é¡µé¢æ¸²æŸ“ -->
    <script defer src="/static/lib/vue.global.js"></script>
    <script defer src="/static/lib/element-plus.full.js"></script>
    <script defer src="/static/lib/element-plus-icons.umd.js"></script>
    <script defer src="/static/device_fingerprint.js"></script>
    <script defer src="/static/api_interceptor.js"></script>
</head>
<body>
    <div id="app">
        <div class="login-container">
            <h2 class="login-title">å…¬å¯“ç‰©ä¸šæ”¶è´¹ç®¡ç†ç³»ç»Ÿ</h2>
            <div v-cloak>
            <el-form :model="loginForm" :rules="loginRules" ref="loginFormRef" @submit.prevent="handleLogin">
                <el-form-item prop="username">
                    <el-input v-model="loginForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" size="large">
                        <template #prefix>
                            <el-icon><user /></el-icon>
                        </template>
                    </el-input>
                </el-form-item>
                <el-form-item prop="password">
                    <el-input v-model="loginForm.password" type="password" placeholder="è¯·è¾“å…¥å¯†ç " show-password size="large" @keyup.enter="handleLogin">
                        <template #prefix>
                            <el-icon><lock /></el-icon>
                        </template>
                    </el-input>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" @click="handleLogin" :loading="loading" size="large" style="width: 100%;">
                       ç™»å½•
                    </el-button>
                </el-form-item>
            </el-form>
            </div>
            <div class="login-footer">
                Â© 2025 ç‰©ä¸šç®¡ç†ç³»ç»Ÿ | ä»…é™å†…éƒ¨ä½¿ç”¨
            </div>
        </div>
    </div>

    <script>
        // ç­‰å¾…Vueã€Element Pluså’ŒIconsåŠ è½½å®Œæˆ
        function initApp() {
            // æ£€æŸ¥åº“æ˜¯å¦å·²åŠ è½½
            if (typeof Vue === 'undefined' || 
                typeof ElementPlus === 'undefined' || 
                typeof ElementPlusIconsVue === 'undefined') {
                setTimeout(initApp, 50);
                return;
            }
            
            const { createApp, ref, reactive } = Vue;
            const { ElForm, ElFormItem, ElInput, ElButton, ElIcon, ElMessage } = ElementPlus;
            const { User, Lock } = ElementPlusIconsVue;

            createApp({
                components: {
                    ElForm, ElFormItem, ElInput, ElButton, ElIcon,
                    User, Lock
                },
                setup() {
                    const loginFormRef = ref();
                    const loading = ref(false);
                    
                    const loginForm = reactive({
                        username: '',
                        password: ''
                    });
                    
                    const loginRules = {
                        username: [{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' }],
                        password: [{ required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' }]
                    };
                    
                    const handleLogin = () => {
                        loginFormRef.value.validate((valid) => {
                            if (!valid) return;
                            
                            loading.value = true;
                            
                            // è°ƒç”¨æˆ‘ä»¬å·²æµ‹è¯•æˆåŠŸçš„ç™»å½•API
                            fetch('/api/login', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    username: loginForm.username,
                                    password: loginForm.password
                                })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'success') {
                                    ElMessage.success(data.message);
                                    // å­˜å‚¨tokenå’Œç”¨æˆ·ä¿¡æ¯åˆ°sessionStorageï¼ˆå…³é—­æµè§ˆå™¨è‡ªåŠ¨æ¸…é™¤ï¼‰
                                    sessionStorage.setItem('token', data.token);
                                    sessionStorage.setItem('user', JSON.stringify(data.user));
                                    // è·³è½¬åˆ°ä¸»å·¥ä½œå°
                                    window.location.href = '/';
                                } else {
                                    ElMessage.error(data.message || 'ç™»å½•å¤±è´¥');
                                }
                            })
                            .catch(error => {
                                console.error('ç™»å½•è¯·æ±‚å¤±è´¥:', error);
                                ElMessage.error('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡');
                            })
                            .finally(() => {
                                loading.value = false;
                            });
                        });
                    };
                    
                    return {
                        loginFormRef,
                        loginForm,
                        loginRules,
                        loading,
                        handleLogin
                    };
                }
            }).use(ElementPlus).mount('#app');
        }
        
        // å¼€å§‹åˆå§‹åŒ–
        initApp();
    </script>
</body>
</html>
